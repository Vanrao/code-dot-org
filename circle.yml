general:
  artifacts:
    - dashboard/test/ui
    - dashboard/log
    - pegasus/log
machine:
  ruby:
    version: 2.2.3
  node:
    version: 6.9
  java:
    version: openjdk8 # used for Applitools merge API tool
  environment:
    RAILS_ENV: test
    RACK_ENV: test
    SPROCKETS_DERAILLEUR_WORKER_COUNT: 2 # CircleCI build VMs have a memory limit of 8G
    DISABLE_SPRING: 1
  services:
    - docker
dependencies:
  pre:
    # update google chrome; Selenium requires that Chrome version must
    # be >= 52.0.2743.0
    - google-chrome --version
    - ./bin/circle/upgrade-google-chrome.sh
    - google-chrome --version
    # Install Yarn
    - npm install -g http-server
  cache_directories:
    - "~/.rvm/gems/ruby-2.2.3"
test:
  override:
    - bundle exec rake circle:run_ui_tests
        parallel: true
        timeout:
            7200
    - ./test.sh:
        pwd:
            cookbooks
